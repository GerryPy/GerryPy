Vulnerability Report
Reviewer: Rachael Wisecarver

Date: February 6, 2017


GerryPy doesn't have many of the usual vulnerabilities, because the user isn't allowed to do much, beyond enter a county weight and a compactness weight and click "Generate District". There is no way to create a new user, so there are no vulnerabilities with respect to user authn or authz (and no Insecure DOR vulnerabilities as a result).

Reviewing GerryPy


## Injection Vulnerabilities

I checked for an instance of an injection vulnerability, but the site seems pretty secure. Users have no way to upload files or other data, nor are there any user inputs that aren't extremely limited by the devs (via a dropdown menu of predetermined choices). I think it would be difficult for a user to enter malicious SQL query here.


## Misconfig Vulnerabilities

I looked for misconfig vulnerabilities in the development.ini and production.ini modules. All debugging modules were set to False in production.ini, which was ultimately pushed to Heroku for public consumption. I don't see a way that malicious users could gain access to sensitive information through a debugger. 

*production.ini*

```
            pyramid.reload_templates = false
            pyramid.debug_authorization = false
            pyramid.debug_notfound = false
            pyramid.debug_routematch = false
```

## XSS Vulnerabilities

I did not find any XSS vulnerabilities. There were no "safe" filters applied, nor was any data returned as raw, unescaped html or javascript. There are no opportunities for users to submit any queries except the two predetermined by the devs (county weight, compactness weight, and generate districts).


## Insecure DOR Vulnerabilities/ Broken Auth

I wasn't able to find any Insecure DOR vulnerabilities, either. There are no user accounts or passwords to authorize or authenticate, and so no gates are necessary before POST requests. For that matter, there aren't even any POST requests. 

Similarly, because there are no User models, there is no way for a malicious user to manipulate a User Model creation form to gain access to sensitive information.


## Sensitive Data Exposure Vulnerabilities
I didn't think I'd be able to find any sensitive data exposure either, because there are no passwords to hash. That being said, when you load the map view with a query, the javascript that loads districts onto a new Google Map using the polygon data from your database is visibile in the inspect tab, complete with a route to what amounts to an API endpoint of all the location data for the map. You can find it at: http://gerrypy.herokuapp.com/json/geo.json.

I'm not even sure that this is a problem. If you wanted to create an API endpoint that people could download and interact with, then well done! If you wanted to keep that information secure, however, then you would have a sensitive data exposure vulnerability that should be fixed-- potentially by escaping the script. Otherwise, because that geojson file is used to make queries to the database, there's a risk that a malicious user could either inject a nasty SQL query into it, or manipulate it in some other way to cause havoc to your site.


## Access

Access isn't really an issue, because there are no users or pages hidden from the view of certain users (and so no permissions blocks necessary). Again, the exception may be that geo.json route, IF you wanted to withhold that from the average user.


## CSRF

I'm not sure that CSRF is really a concern here, because the site trusts all users equally (not at all), and doesn't allow for any user input. No queries are expsed to the users-- except potentially via that geojson file. If you were really concerned, you could add CSRF protection to your map form and views, like so:

*map.jinja2*

```
            <form id='mapform'>
            # Add in the following:
                <input type="hidden" name="csrf_token" value="{{ request.session.get_csrf_token() }}"/>
```

In scripts/default.py, you could add a require_csrf=True to your @view_config:


*scripts/default.py*

```
            @view_config(route_name='map', renderer='../templates/map.jinja2', require_csrf=True)
            def map_view(request):
                """If form submitted, generate districts and return map with geojson."""
                if request.GET:
                    criteria = {
                        'county' : request.GET['countyweight'],
                        'compactness' : request.GET['compactweight']
                    }
                    num_dst = 7
                    state = State(request, num_dst)
                    state.fill_state(request, criteria)
                    with open('gerrypy/views/geo.json', 'w') as the_file:
                        the_file.write(build_JSON(request))
                    return {'geojson': 'ok'}
                return {}
```

Alternatively, you could add a security.py, with an include_me method that includes
a config setting your default csrf options to require_csrf=True.

```
            config.set_default_csrf_options(require_csrf=True)
```

